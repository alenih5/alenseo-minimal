<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alenseo Plugin AJAX Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin-bottom: 30px; padding: 20px; border: 1px solid #ccc; border-radius: 5px; }
        .test-section h2 { margin-top: 0; color: #333; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 3px; }
        .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        button { padding: 10px 15px; margin: 5px; background: #0073aa; color: white; border: none; border-radius: 3px; cursor: pointer; }
        button:hover { background: #005a87; }
        input[type="text"], input[type="password"] { padding: 8px; margin: 5px; width: 300px; }
        .status-indicator { display: inline-block; width: 10px; height: 10px; border-radius: 50%; margin-right: 5px; }
        .status-connected { background: #28a745; }
        .status-error { background: #dc3545; }
        .status-unknown { background: #6c757d; }
    </style>
</head>
<body>
    <h1>Alenseo SEO Plugin - AJAX Test Suite</h1>
    <p><em>Diese Seite testet alle AJAX-Funktionen des Alenseo SEO Plugins.</em></p>

    <!-- API Tests Section -->
    <div class="test-section">
        <h2>API Connection Tests</h2>
        
        <div>
            <h3>Claude API Test</h3>
            <input type="password" id="claude-api-key" placeholder="Claude API Key eingeben...">
            <select id="claude-model">
                <option value="claude-3-5-sonnet-20241022">Claude 3.5 Sonnet</option>
                <option value="claude-3-opus-20240229">Claude 3 Opus</option>
                <option value="claude-3-haiku-20240307">Claude 3 Haiku</option>
            </select>
            <button onclick="testClaudeAPI()">Claude API testen</button>
            <div id="claude-result" class="test-result"></div>
        </div>

        <div>
            <h3>OpenAI API Test</h3>
            <input type="password" id="openai-api-key" placeholder="OpenAI API Key eingeben...">
            <button onclick="testOpenAIAPI()">OpenAI API testen</button>
            <div id="openai-result" class="test-result"></div>
        </div>
    </div>

    <!-- Dashboard Data Test -->
    <div class="test-section">
        <h2>Dashboard Data Test</h2>
        <button onclick="loadDashboardData()">Dashboard Daten laden</button>
        <div id="dashboard-result" class="test-result"></div>
    </div>

    <!-- Posts Loading Test -->
    <div class="test-section">
        <h2>Posts Loading Test</h2>
        <button onclick="loadPosts()">Posts für Optimizer laden</button>
        <div id="posts-result" class="test-result"></div>
    </div>

    <!-- API Status Test -->
    <div class="test-section">
        <h2>API Status Test</h2>
        <button onclick="getAPIStatus()">API Status abrufen</button>
        <div id="api-status-result" class="test-result"></div>
    </div>

    <!-- Bulk Analysis Test -->
    <div class="test-section">
        <h2>Bulk Analysis Test</h2>
        <input type="text" id="post-ids" placeholder="Post IDs (comma separated): 1,2,3">
        <button onclick="testBulkAnalysis()">Bulk Analyse starten</button>
        <div id="bulk-result" class="test-result"></div>
    </div>

    <!-- System Status -->
    <div class="test-section">
        <h2>System Status</h2>
        <div id="system-status">
            <p><span class="status-indicator status-unknown"></span> WordPress AJAX URL: <span id="ajax-url-status">Wird geprüft...</span></p>
            <p><span class="status-indicator status-unknown"></span> Nonce: <span id="nonce-status">Wird generiert...</span></p>
            <p><span class="status-indicator status-unknown"></span> Plugin aktiv: <span id="plugin-status">Wird geprüft...</span></p>
        </div>
    </div>

    <script>
        // WordPress AJAX URL und Nonce - normalerweise von WordPress bereitgestellt
        const ajaxurl = 'YOUR_WORDPRESS_SITE/wp-admin/admin-ajax.php';
        const nonce = 'GENERATED_NONCE'; // In echter WordPress-Umgebung würde dies durch wp_create_nonce() generiert

        // System Status Updates
        document.getElementById('ajax-url-status').textContent = ajaxurl || 'Nicht verfügbar';
        document.getElementById('nonce-status').textContent = nonce || 'Nicht verfügbar';

        // Test Claude API
        function testClaudeAPI() {
            const apiKey = document.getElementById('claude-api-key').value;
            const model = document.getElementById('claude-model').value;
            const resultDiv = document.getElementById('claude-result');

            if (!apiKey) {
                showResult(resultDiv, 'error', 'Bitte geben Sie einen Claude API Key ein.');
                return;
            }

            showResult(resultDiv, 'info', 'Teste Claude API...');

            fetch(ajaxurl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: new URLSearchParams({
                    action: 'alenseo_test_claude_api',
                    api_key: apiKey,
                    model: model,
                    nonce: nonce
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showResult(resultDiv, 'success', 'Claude API erfolgreich getestet: ' + data.data.message);
                } else {
                    showResult(resultDiv, 'error', 'Claude API Test fehlgeschlagen: ' + data.data.message);
                }
            })
            .catch(error => {
                showResult(resultDiv, 'error', 'Fehler beim Claude API Test: ' + error.message);
            });
        }

        // Test OpenAI API
        function testOpenAIAPI() {
            const apiKey = document.getElementById('openai-api-key').value;
            const resultDiv = document.getElementById('openai-result');

            if (!apiKey) {
                showResult(resultDiv, 'error', 'Bitte geben Sie einen OpenAI API Key ein.');
                return;
            }

            showResult(resultDiv, 'info', 'Teste OpenAI API...');

            fetch(ajaxurl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: new URLSearchParams({
                    action: 'alenseo_test_openai_api',
                    api_key: apiKey,
                    nonce: nonce
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showResult(resultDiv, 'success', 'OpenAI API erfolgreich getestet: ' + data.data.message);
                } else {
                    showResult(resultDiv, 'error', 'OpenAI API Test fehlgeschlagen: ' + data.data.message);
                }
            })
            .catch(error => {
                showResult(resultDiv, 'error', 'Fehler beim OpenAI API Test: ' + error.message);
            });
        }

        // Load Dashboard Data
        function loadDashboardData() {
            const resultDiv = document.getElementById('dashboard-result');
            showResult(resultDiv, 'info', 'Lade Dashboard Daten...');

            fetch(ajaxurl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: new URLSearchParams({
                    action: 'alenseo_get_dashboard_data',
                    nonce: nonce
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const stats = data.data;
                    let message = `Dashboard Daten erfolgreich geladen:<br>
                        • Analysierte Posts: ${stats.analyzed_posts}<br>
                        • Durchschnittlicher SEO Score: ${stats.average_score}<br>
                        • Posts mit gutem SEO: ${stats.good_seo}<br>
                        • Posts mit schlechtem SEO: ${stats.poor_seo}<br>
                        • Letzte Aktivitäten: ${stats.recent_activity.length} Einträge`;
                    showResult(resultDiv, 'success', message);
                } else {
                    showResult(resultDiv, 'error', 'Dashboard Daten laden fehlgeschlagen: ' + data.data.message);
                }
            })
            .catch(error => {
                showResult(resultDiv, 'error', 'Fehler beim Laden der Dashboard Daten: ' + error.message);
            });
        }

        // Load Posts
        function loadPosts() {
            const resultDiv = document.getElementById('posts-result');
            showResult(resultDiv, 'info', 'Lade Posts...');

            fetch(ajaxurl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: new URLSearchParams({
                    action: 'alenseo_load_posts',
                    page: 1,
                    posts_per_page: 10,
                    nonce: nonce
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const posts = data.data.posts;
                    let message = `${posts.length} Posts erfolgreich geladen:<br>`;
                    posts.slice(0, 5).forEach(post => {
                        message += `• ${post.title} (ID: ${post.id}, Score: ${post.seo_score || 'N/A'})<br>`;
                    });
                    if (posts.length > 5) {
                        message += `... und ${posts.length - 5} weitere`;
                    }
                    showResult(resultDiv, 'success', message);
                } else {
                    showResult(resultDiv, 'error', 'Posts laden fehlgeschlagen: ' + data.data.message);
                }
            })
            .catch(error => {
                showResult(resultDiv, 'error', 'Fehler beim Laden der Posts: ' + error.message);
            });
        }

        // Get API Status
        function getAPIStatus() {
            const resultDiv = document.getElementById('api-status-result');
            showResult(resultDiv, 'info', 'Prüfe API Status...');

            fetch(ajaxurl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: new URLSearchParams({
                    action: 'alenseo_get_api_status',
                    nonce: nonce
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const status = data.data;
                    let message = `API Status:<br>
                        • Claude API: ${status.claude_configured ? '✅ Konfiguriert' : '❌ Nicht konfiguriert'}<br>
                        • OpenAI API: ${status.openai_configured ? '✅ Konfiguriert' : '❌ Nicht konfiguriert'}<br>
                        • Plugin Version: ${status.plugin_version || 'Unbekannt'}`;
                    showResult(resultDiv, 'success', message);
                } else {
                    showResult(resultDiv, 'error', 'API Status abrufen fehlgeschlagen: ' + data.data.message);
                }
            })
            .catch(error => {
                showResult(resultDiv, 'error', 'Fehler beim Abrufen des API Status: ' + error.message);
            });
        }

        // Test Bulk Analysis
        function testBulkAnalysis() {
            const postIds = document.getElementById('post-ids').value;
            const resultDiv = document.getElementById('bulk-result');

            if (!postIds) {
                showResult(resultDiv, 'error', 'Bitte geben Sie Post IDs ein (z.B. 1,2,3).');
                return;
            }

            showResult(resultDiv, 'info', 'Starte Bulk Analyse...');

            fetch(ajaxurl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: new URLSearchParams({
                    action: 'alenseo_bulk_analyze',
                    post_ids: postIds,
                    nonce: nonce
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showResult(resultDiv, 'success', 'Bulk Analyse erfolgreich gestartet: ' + data.data.message);
                } else {
                    showResult(resultDiv, 'error', 'Bulk Analyse fehlgeschlagen: ' + data.data.message);
                }
            })
            .catch(error => {
                showResult(resultDiv, 'error', 'Fehler bei der Bulk Analyse: ' + error.message);
            });
        }

        // Helper function to show results
        function showResult(element, type, message) {
            element.className = 'test-result ' + type;
            element.innerHTML = message;
        }

        // Initial system checks
        document.addEventListener('DOMContentLoaded', function() {
            // Check if we're in WordPress environment
            if (typeof ajaxurl === 'undefined' || ajaxurl.includes('YOUR_WORDPRESS_SITE')) {
                showResult(document.getElementById('system-status'), 'error', 
                    'HINWEIS: Diese Testseite muss in einer echten WordPress-Umgebung ausgeführt werden. ' +
                    'Kopieren Sie diese Datei in Ihr WordPress-Theme oder Plugin-Verzeichnis und rufen Sie sie über WordPress auf.');
            }
        });
    </script>
</body>
</html>
